##Data from Chuine
##no plots listed for 2003
clean.raw$chuine <- function(filename, path="./Experiments/chuine") {
chuinefiles<-c("Chuine_pheno_2002.csv","Chuine_pheno_2003_cleaned.csv","Chuine_pheno_2004.csv","Chuine_pheno_2005.csv")
years<-c(2002,2003,2004,2005)
chuine <- NA
for (i in 1:length(chuinefiles)){
file <- file.path(path, paste(chuinefiles[i]))
chuine1 <- read.csv(file, header=TRUE)
chuine1$plot<-paste(chuine1$block,chuine1$Plot,sep="")
colnames(chuine1)[which(colnames(chuine1)=="species"|colnames(chuine1)=="Species")]<-"sp"
colnames(chuine1)[which(colnames(chuine1)=="X55")]<-"ffb"
colnames(chuine1)[which(colnames(chuine1)=="X65")]<-"ffd"
colnames(chuine1)[which(colnames(chuine1)=="X85")]<-"ffrd"
colnames(chuine1)[which(colnames(chuine1)=="X91")]<-"91"
#colnames(chuine1)[which(colnames(chuine1)=="X95")]<-"sen"
chuine1<-chuine1[!is.na(chuine1$sp),]
phen1<-which(colnames(chuine1)=="ffb")
phen2<-which(colnames(chuine1)=="ffrd")
chuine2<-reshape(chuine1,varying = list(names(chuine1)[phen1:phen2]), direction = "long", v.names = c("date"), times = c(names(chuine1)[phen1:phen2]))
chuine2$year<-paste(years[i])
chuine2<-chuine2[!chuine2$date=="",]
colnames(chuine2)[which(colnames(chuine2)=="time")]<-"event"
if(years[i]==2002){chuine2$doy<-strftime(strptime(chuine2$date, format = "%d/%m/%y"),format = "%j")}
if(years[i]==2003){chuine2$doy<-strftime(strptime(chuine2$date, format = "%d-%b"),format = "%j")}
if(years[i]==2004){chuine2$doy<-strftime(strptime(chuine2$date, format = "%d-%b"),format = "%j")}
if(years[i]==2005){chuine2$doy<-strftime(strptime(chuine2$date, format = "%d-%b"),format = "%j")}
chuine3<-subset(chuine2, select=c("plot","sp", "event","year","doy"))
chuine<-rbind(chuine,chuine3)
}
chuine<-chuine[-1,]
chuine$genus<-NA
chuine$species<-NA
chuine$genus[chuine$sp=="aa"] <- "Artemesia"
chuine$species[chuine$sp=="aa"] <- "annua"
chuine$genus[chuine$sp=="av"] <- "Artemesia"
chuine$species[chuine$sp=="av"] <- "vulgaris"
chuine$genus[chuine$sp=="ar"] <- "Amaranthus"
chuine$species[chuine$sp=="ar"] <- "retroflexus"
chuine$genus[chuine$sp=="ad"] <- "Amaranthus"
chuine$species[chuine$sp=="ad"] <- "deflexus"
chuine$genus[chuine$sp=="qr"] <- "Quercus"
chuine$species[chuine$sp=="qr"] <- "robur"
chuine$genus[chuine$sp=="qp"] <- "Quercus"
chuine$species[chuine$sp=="qp"] <- "pubescens"
chuine$genus[chuine$sp=="qi"] <- "Quercus"
chuine$species[chuine$sp=="qi"] <- "ilex"
chuine$genus[chuine$sp=="lr"] <- "Lolium"
chuine$species[chuine$sp=="lr"] <- "rigidum"
chuine$genus[chuine$sp=="lp"] <- "Lolium"
chuine$species[chuine$sp=="lp"] <- "perenne"
chuine$genus[chuine$sp=="sv"] <- "Setaria"
chuine$species[chuine$sp=="sv"] <- "viridis"
chuine$genus[chuine$sp=="sp"] <- "Setaria"
chuine$species[chuine$sp=="sp"] <- "parviflora"
chuine$genus[chuine$sp=="lp3"] <- "Lolium"
chuine$species[chuine$sp=="lp3"] <- "perenne"
chuine$site<-"chuine"
chuine4<-subset(chuine, select=c("site","plot","event","year","genus","species", "doy"))
#chuine4$variety <- NA
#chuine4$cult <- NA
chuine4<-chuine4[!is.na(chuine4$doy),]
return(chuine4)
##
}
# Produce cleaned raw data
#
raw.data.dir <- "./Experiments"
cleandata.raw <- list()
cleandata.raw$marchin <- clean.raw$marchin(path="./Experiments/marchin")
cleandata.raw$bace <- clean.raw$bace(path="./Experiments/bace")
cleandata.raw$farnsworth <- clean.raw$farnsworth(path="./Experiments/farnsworth")
cleandata.raw$jasper <- clean.raw$jasper(path="./Experiments/jasper")
cleandata.raw$clarkduke <- clean.raw$clarkduke(path="./Experiments/clark")
cleandata.raw$clarkharvard <- clean.raw$clarkharvard(path="./Experiments/clark")
cleandata.raw$sherry <- clean.raw$sherry(path="./Experiments/sherry")
cleandata.raw$price <- clean.raw$price(path="./Experiments/price")
cleandata.raw$chuine<- clean.raw$chuine(path="./Experiments/chuine")
expphendb <- do.call("rbind", cleandata.raw)
row.names(expphendb) <- NULL
#expphendb<-expphendb[!is.na(expphendb$doy),]
expphendb<-expphendb[-which(expphendb$genus=="Ob"),]#unknown genus at clarkduke
expphendb<-expphendb[-which(expphendb$genus=="Le"),]#unknown genus at clarkharvard
clean.obsclim <- list()
path="./Observations/Temp"
tmaxfiles<-c("tmax_augspurger.csv","tmax_bock.csv","tmax_bolmgren.csv","tmax_concord.csv","tmax_fargo.csv","tmax_fitter.csv","tmax_gothic.csv","tmax_harvard.csv","tmax_hubbard.csv","tmax_konza.csv","tmax_marsham.csv","tmax_mikesell.csv","tmax_mohonk.csv","tmax_niwot.csv","tmax_rousi.csv","tmax_siernev1.csv","tmax_siernev2.csv","tmax_uwm.csv","tmax_washdc.csv","tmax_zacken.csv")
tminfiles<-c("tmin_augspurger.csv","tmin_bock.csv","tmin_bolmgren.csv","tmin_concord.csv","tmin_fargo.csv","tmin_fitter.csv","tmin_gothic.csv","tmin_harvard.csv","tmin_hubbard.csv","tmin_konza.csv","tmin_marsham.csv","tmin_mikesell.csv","tmin_mohonk.csv","tmin_niwot.csv","tmin_rousi.csv","tmin_siernev1.csv","tmin_siernev2.csv","tmin_uwm.csv","tmin_washdc.csv","tmin_zacken.csv")
sites<-c("augspurger","bock","bolmgren","concord","fargo","fitter","gothic","harvard","hubbard","konza","marsham","mikesell","mohonk","niwot","rousi","siernev1","siernev2","uwm","washdc","zacken")
tempallsites<-NA
for (i in 1:length(sites)){
file1 <- file.path(path, paste(tmaxfiles[i]))
file2 <- file.path(path, paste(tminfiles[i]))
maxtemp1 <- read.csv(file1, header=TRUE)
mintemp1 <- read.csv(file2, header=TRUE)
colnames(maxtemp1)[1]<-"year"
colnames(mintemp1)[1]<-"year"
maxtemp1.long<-reshape(maxtemp1,varying = list(names(maxtemp1)[2:367]), direction = "long", v.names = c("tmax"), times = c(1:366))
mintemp1.long<-reshape(mintemp1,varying = list(names(mintemp1)[2:367]), direction = "long", v.names = c("tmin"), times = c(1:366))
alltemp<-merge(maxtemp1.long,mintemp1.long)
colnames(alltemp)[2:3]<-c("doy","nyr")
alltemp$site<-paste(sites[i])
tempallsites<-rbind(tempallsites,alltemp)
}
tempallsites<-tempallsites[-1,]
tbase<-10
tempallsites$tmean<-(tempallsites$tmin+tempallsites$tmax)/2
tempallsites$gdd_10<-tempallsites$tmean-tbase
head(exphenclim)
clean.clim <- list()
clean.clim$marchin <- function(filename="hf113-10-df-chamber.csv",path="./Experiments/marchin") {
## Marchin ##
## Data type: temp (air and soil), soil moisture, in chambers (incuding 3 unheated control chambers, 9 heated chambers, and 3 outside controls that lack chambers); regression heating design
## Notes: Contact: Renee Marchin, renee.marchin@sydney.edu.au##
##climate data available at: http://harvardforest.fas.harvard.edu:8080/exist/apps/datasets/showData.html?id=hf113
file <- file.path(path, filename)
marchin1 <- read.csv(file, check.names=FALSE, header=TRUE)
names(marchin1)[8]<-"plot"
marchin1$year_doy<-paste(marchin1$year,marchin1$doy, sep="-")
#get min airtemp across all 3 measurements for each plot
temp_min<-aggregate(x=subset(marchin1, select=c("CAT1_Min","CAT2_Min","CAT3_Min","CSTo1_Min","CSTo2_Min","CSTI1_Min","CSTI2_Min")), by=list(marchin1$year_doy,marchin1$plot), FUN=min)
airtemp_min<-apply(temp_min[,3:5],1,min)
soiltemp1_min<-apply(temp_min[,6:7],1,min)#temp at 2cm depth(organic)
soiltemp2_min<-apply(temp_min[,8:9],1,min)#temp at 6cm depth(inorganic)
temp_max<-aggregate(x=subset(marchin1, select=c("CAT1_Max","CAT2_Max","CAT3_Max","CSTo1_Max","CSTo2_Max","CSTI1_Max","CSTI2_Max")), by=list(marchin1$year_doy,marchin1$plot), FUN=max)
airtemp_max<-apply(temp_max[,3:5],1,max)
soiltemp1_max<-apply(temp_max[,6:7],1,max)#temp at 2cm depth(organic)
soiltemp2_max<-apply(temp_max[,8:9],1,max)#temp at 6cm depth(inorganic)
soilmois<-aggregate(x=subset(marchin1, select=c("CSM_Avg")), by=list(marchin1$year_doy,marchin1$plot), FUN=mean)
colnames(temp_min)[1:2]<-c("year_doy","plot")
year_doy <- strsplit(temp_min$year_doy,'-')
year_doy<-do.call(rbind, year_doy)
allclim<-as.data.frame(cbind(year_doy,airtemp_min,airtemp_max,soiltemp1_min,soiltemp2_min,soiltemp1_max,soiltemp2_max,soilmois))
colnames(allclim)[9:11]<-c("year_doy","plot","soilmois")
colnames(allclim)[1:2]<-c("year","doy")
allclim$preciptreat<-NA
allclim$temptreat<-1
allclim[allclim$plot==2,]$temptreat<-0
allclim[allclim$plot==5,]$temptreat<-0
allclim[allclim$plot==11,]$temptreat<-0
allclim1<-subset(allclim, select=c("temptreat","preciptreat","plot","year","doy","airtemp_min","airtemp_max","soiltemp1_min","soiltemp2_min","soiltemp1_max","soiltemp2_max","soilmois"))
file2<-file.path(path, "hf113-11-df-outside.csv")
marchin2<-read.csv(file2, header=TRUE)
marchin2$year_doy<-paste(marchin2$year,marchin2$doy, sep="-")
marchin2$plot<-"outside"
temp_min2<-aggregate(x=subset(marchin2, select=c("oAT1_Min","oAT2_Min","oAT3_Min","oSTo1_Min","oSTo2_Min","oSTo3_Min","oSTI1_Min","oSTI2_Min","oSTI3_Min")), by=list(marchin2$year_doy,marchin2$plot), FUN=min)
airtemp_min<-apply(temp_min2[,3:5],1,min)
soiltemp1_min<-apply(temp_min2[,6:8],1,min)#temp at 2cm depth(organic)
soiltemp2_min<-apply(temp_min2[,9:11],1,min)#temp at 6cm depth(inorganic)
temp_max2<-aggregate(x=subset(marchin2, select=c("oAT1_Max","oAT2_Max","oAT3_Max","oSTo1_Max","oSTo2_Max","oSTo3_Max","oSTI1_Max","oSTI2_Max","oSTI3_Max")), by=list(marchin2$year_doy,marchin2$plot), FUN=max)
airtemp_max<-apply(temp_max2[,3:5],1,max)
soiltemp1_max<-apply(temp_max2[,6:8],1,max)#temp at 2cm depth(organic)
soiltemp2_max<-apply(temp_max2[,9:11],1,max)#temp at 6cm depth(inorganic)
#looks like no soil moisture for outside chambers?
colnames(temp_min2)[1:2]<-c("year_doy","plot")
year_doy <- strsplit(temp_min2$year_doy,'-')
year_doy<-do.call(rbind, year_doy)
temptreat<-rep("outside",times=dim(year_doy)[1])
preciptreat<-rep("outside",times=dim(year_doy)[1])
oallclim<-as.data.frame(cbind(temptreat,preciptreat,temp_min2$plot,year_doy,airtemp_min, airtemp_max,soiltemp1_min, soiltemp2_min,soiltemp1_max,soiltemp2_max))
oallclim$soilmois<-NA
colnames(oallclim)[3:5]<-c("plot","year","doy")
allclim2<-rbind(allclim1,oallclim)
allclim2$site<-"marchin"
allclim2$soiltemp1_mean<-(as.numeric(allclim2$soiltemp1_min)+as.numeric(allclim2$soiltemp1_max))/2
marchinclim<-subset(allclim2, select=c("site","temptreat","preciptreat","plot","year","doy","airtemp_min","airtemp_max","soiltemp1_min","soiltemp2_min","soiltemp1_max","soiltemp2_max","soiltemp1_mean","soilmois"))
row.names(marchinclim) <- NULL
return(marchinclim)
}
##Farnsworth from Harvard ##
## Data type: soil temp (celsius, at 5cm depth) and soil moisture (% volumetric moisture content) in heated plots (=h=1,6,8,12,15,16), disturbance control plots (=d=3,5,9,10,13,17), and control plots (=c=2,4,7,11,14,18)
##(no air temp)
## Notes: Contact: Public data,http://harvardforest.fas.harvard.edu:8080/exist/apps/datasets/showData.html?id=hf005
clean.clim$farnsworth <- function(filename="hf005-04-soil-temp.csv", path="./Experiments/farnsworth/") {
file <- file.path(path, filename)
temp<- read.csv(file, header=TRUE)
temp.long<-reshape(temp,varying = list(colnames(temp)[6:23]), direction = "long", v.names = c("soiltemp1_mean"), times = c(colnames(temp)[6:23]))
colnames(temp.long)[10]<-"plotfull"
temp.long$plot<-substr(temp.long$plotfull,5,6)
temp.long[temp.long$plotfull=="plot1h",]$plot=1
temp.long[temp.long$plotfull=="plot6h",]$plot=6
temp.long[temp.long$plotfull=="plot8h",]$plot=8
temp.long[temp.long$plotfull=="plot3d",]$plot=3
temp.long[temp.long$plotfull=="plot5d",]$plot=5
temp.long[temp.long$plotfull=="plot9d",]$plot=9
temp.long[temp.long$plotfull=="plot2c",]$plot=2
temp.long[temp.long$plotfull=="plot4c",]$plot=4
temp.long[temp.long$plotfull=="plot7c",]$plot=7
temp.long2<-subset(temp.long,selec=c("year","doy","plot","soiltemp1_mean"))
file2<-file.path(path, "hf005-05-soil-respiration.csv")
mois<-read.csv(file2,  header=TRUE)
mois$doy<-strftime(strptime(paste(mois$year,mois$month,mois$day,sep="-"), format = "%Y-%m-%d"),format = "%j")
mois2<-subset(mois,selec=c("year","doy","plot","treatment","moisture","temp.4cm"))
allclim<-merge(temp.long2,mois2,by.x=c("year","doy","plot"),by.y=c("year","doy","plot"),all=TRUE)
allclim$airtemp_min<-NA
allclim$airtemp_max<-NA
allclim$soiltemp1_min<-NA
allclim$soiltemp2_min<-NA
allclim$soiltemp1_max<-NA
allclim$soiltemp2_max<-NA
colnames(allclim)[6]<-"soilmois"
colnames(allclim)[5]<-"treatment2"
allclim$temptreat<-NA
allclim[which(allclim$treatment2=="H"),]$temptreat<-1
allclim[which(allclim$treatment2=="C"),]$temptreat<-0
allclim[which(allclim$treatment2=="DC"),]$temptreat<-"sham"
allclim$site<-"farnsworthharv"
allclim$preciptreat<-NA
farnsworthclim<-subset(allclim, select=c("site","temptreat","preciptreat","plot","year","doy","airtemp_min","airtemp_max","soiltemp1_min","soiltemp2_min","soiltemp1_max","soiltemp2_max","soiltemp1_mean","soilmois"))
row.names(farnsworthclim) <- NULL
return(farnsworthclim)
}
##Clark et al from Harvard ##
## Data type: hourly air temp, soil temp (celsius, at 5cm depth) and soil moisture (Estimated ratio of volumetric water content, scaled from 0 to 1) in heated plots, "ambient" plots = like disturbance control plots, and control plots with mesh walls, no heating infrastructure
## Notes: Public data,
clean.clim$clarkharvard <- function(filename="data-Harvard-ST1.csv", path="./Experiments/clark") {
file <- file.path(path, filename)
soiltemp_hr<- read.csv(file, header=TRUE)
soiltemp.long<-reshape(soiltemp_hr,varying = list(colnames(soiltemp_hr)[8:31]), direction = "long", v.names = c("soiltemp"), times = c(colnames(soiltemp_hr)[8:31]))
soiltemp.long$plot<-substr(soiltemp.long$time,1,3)
soiltemp.long$doy<-strftime(strptime(paste(soiltemp.long$year,soiltemp.long$month,soiltemp.long$day,sep="-"), format = "%Y-%m-%d"),format = "%j")
soiltemp.long$year_doy <- paste(soiltemp.long$year,soiltemp.long$doy, sep="")
soiltemp1_min<-aggregate(x=subset(soiltemp.long, select="soiltemp"), by=list(soiltemp.long$year_doy,soiltemp.long$plot), FUN=min)
colnames(soiltemp1_min)<-c("year_doy","plot","soiltemp1_min")
soiltemp1_max<-aggregate(x=subset(soiltemp.long, select="soiltemp"), by=list(soiltemp.long$year_doy,soiltemp.long$plot), FUN=max)
colnames(soiltemp1_max)<-c("year_doy","plot","soiltemp1_max")
soiltemp<-as.data.frame(cbind(soiltemp1_min$year_doy,soiltemp1_min$plot,soiltemp1_min$soiltemp1_min,soiltemp1_max$soiltemp1_max))
colnames(soiltemp)<-c("year_doy","plot","soiltemp1_min","soiltemp1_max")
file2<-file.path(path, "data-Harvard-SM.csv")
mois_hr<-read.csv(file2,  header=TRUE)
mois.long<-reshape(mois_hr,varying = list(colnames(mois_hr)[8:31]), direction = "long", v.names = c("soilmois"), times = c(colnames(mois_hr)[8:31]))
mois.long$plot<-substr(mois.long$time,1,3)
mois.long$doy<-strftime(strptime(paste(mois.long$year,mois.long$month,mois.long$day,sep="-"), format = "%Y-%m-%d"),format = "%j")
mois.long$year_doy <- paste(mois.long$year,mois.long$doy, sep="")
soilmois<-aggregate(x=subset(mois.long, select="soilmois"), by=list(soiltemp.long$year_doy,soiltemp.long$plot), FUN=mean)
colnames(soilmois)<-c("year_doy","plot","soilmois")
file3<-file.path(path, "data-Harvard-AT.csv")
airtemp_hr<-read.csv(file3,  header=TRUE)
airtemp.long<-reshape(airtemp_hr,varying = list(colnames(airtemp_hr)[8:31]), direction = "long", v.names = c("airtemp"), times = c(colnames(airtemp_hr)[8:31]))
airtemp.long$plot<-substr(airtemp.long$time,1,3)
airtemp.long$doy<-strftime(strptime(paste(airtemp.long$year,airtemp.long$month,airtemp.long$day,sep="-"), format = "%Y-%m-%d"),format = "%j")
airtemp.long$year_doy <- paste(airtemp.long$year,airtemp.long$doy, sep="")
airtemp_min<-aggregate(x=subset(airtemp.long, select="airtemp"), by=list(airtemp.long$year_doy,airtemp.long$plot), FUN=min)
colnames(airtemp_min)<-c("year_doy","plot","airtemp_min")
airtemp_max<-aggregate(x=subset(airtemp.long, select="airtemp"), by=list(airtemp.long$year_doy,airtemp.long$plot), FUN=max)
colnames(airtemp_max)<-c("year_doy","plot","airtemp_max")
airtemp<-as.data.frame(cbind(airtemp_min$year_doy,airtemp_min$plot,airtemp_min$airtemp_min,airtemp_max$airtemp_max))
colnames(airtemp)<-c("year_doy","plot","airtemp_min","airtemp_max")
allclim<-merge(airtemp,soiltemp,by=c("year_doy","plot"), all=TRUE)
allclim2<-merge(allclim,soilmois,by=c("year_doy","plot"), all=TRUE)
allclim2$year<-substr(allclim2$year_doy,1,4)
allclim2$doy<-substr(allclim2$year_doy,5,7)
allclim2$site<-"clarkharvard"
allclim2$temptreat<-NA
allclim2[allclim2$plot=="G02"|allclim2$plot=="G04"|allclim2$plot=="G07"|allclim2$plot=="S02"|allclim2$plot=="S05"|allclim2$plot=="S07",]$temptreat<-"sham"#disturbance control
allclim2[allclim2$plot=="G03"|allclim2$plot=="G05"|allclim2$plot=="G09"|allclim2$plot=="S01"|allclim2$plot=="S04"|allclim2$plot=="S09",]$temptreat<-2
allclim2[allclim2$plot=="G01"|allclim2$plot=="G06"|allclim2$plot=="G08"|allclim2$plot=="S03"|allclim2$plot=="S06"|allclim2$plot=="S08",]$temptreat<-1
allclim2[allclim2$plot=="G10"|allclim2$plot=="G11"|allclim2$plot=="G12"|allclim2$plot=="S10"|allclim2$plot=="S11"|allclim2$plot=="S12",]$temptreat<-0
allclim2$preciptreat<-NA
allclim2$soiltemp2_min<-NA
allclim2$soiltemp2_max<-NA
allclim2$soiltemp1_mean<-(as.numeric(allclim2$soiltemp1_min)+as.numeric(allclim2$soiltemp1_max))/2
clarkharvardclim<-subset(allclim2, select=c("site","temptreat","preciptreat","plot","year","doy","airtemp_min","airtemp_max","soiltemp1_min","soiltemp2_min","soiltemp1_max","soiltemp2_max","soiltemp1_mean","soilmois"))
row.names(clarkharvardclim) <- NULL
return(clarkharvardclim)
}
##Clark et al from Duke ##
## Data type: hourly air temp, soil temp (celsius, at 5cm depth) and soil moisture (Estimated ratio of volumetric water content, scaled from 0 to 1) in heated plots, "ambient" plots = like disturbance control plots, and control plots with mesh walls, no heating infrastructure
## Notes: Public data,
clean.clim$clarkduke <- function(filename="data-Duke-ST.csv", path="./Experiments/clark") {
file <- file.path(path, filename)
soiltemp_hr<- read.csv(file, header=TRUE)
soiltemp.long<-reshape(soiltemp_hr,varying = list(colnames(soiltemp_hr)[8:31]), direction = "long", v.names = c("soiltemp"), times = c(colnames(soiltemp_hr)[8:31]))
soiltemp.long$plot<-substr(soiltemp.long$time,1,3)
soiltemp.long$doy<-strftime(strptime(paste(soiltemp.long$year,soiltemp.long$month,soiltemp.long$day,sep="-"), format = "%Y-%m-%d"),format = "%j")
soiltemp.long$year_doy <- paste(soiltemp.long$year,soiltemp.long$doy, sep="")
soiltemp1_min<-aggregate(x=subset(soiltemp.long, select="soiltemp"), by=list(soiltemp.long$year_doy,soiltemp.long$plot), FUN=min)
colnames(soiltemp1_min)<-c("year_doy","plot","soiltemp1_min")
soiltemp1_max<-aggregate(x=subset(soiltemp.long, select="soiltemp"), by=list(soiltemp.long$year_doy,soiltemp.long$plot), FUN=max)
colnames(soiltemp1_max)<-c("year_doy","plot","soiltemp1_max")
soiltemp<-as.data.frame(cbind(soiltemp1_min$year_doy,soiltemp1_min$plot,soiltemp1_min$soiltemp1_min,soiltemp1_max$soiltemp1_max))
colnames(soiltemp)<-c("year_doy","plot","soiltemp1_min","soiltemp1_max")
file2<-file.path(path, "data-Duke-SM.csv")
mois_hr<-read.csv(file2,  header=TRUE)
mois.long<-reshape(mois_hr,varying = list(colnames(mois_hr)[8:31]), direction = "long", v.names = c("soilmois"), times = c(colnames(mois_hr)[8:31]))
mois.long$plot<-substr(mois.long$time,1,3)
mois.long$doy<-strftime(strptime(paste(mois.long$year,mois.long$month,mois.long$day,sep="-"), format = "%Y-%m-%d"),format = "%j")
mois.long$year_doy <- paste(mois.long$year,mois.long$doy, sep="")
soilmois<-aggregate(x=subset(mois.long, select="soilmois"), by=list(soiltemp.long$year_doy,soiltemp.long$plot), FUN=mean)
colnames(soilmois)<-c("year_doy","plot","soilmois")
file3<-file.path(path, "data-Duke-AT.csv")
airtemp_hr<-read.csv(file3,  header=TRUE)
airtemp.long<-reshape(airtemp_hr,varying = list(colnames(airtemp_hr)[8:31]), direction = "long", v.names = c("airtemp"), times = c(colnames(airtemp_hr)[8:31]))
airtemp.long$plot<-substr(airtemp.long$time,1,3)
airtemp.long$doy<-strftime(strptime(paste(airtemp.long$year,airtemp.long$month,airtemp.long$day,sep="-"), format = "%Y-%m-%d"),format = "%j")
airtemp.long$year_doy <- paste(airtemp.long$year,airtemp.long$doy, sep="")
airtemp_min<-aggregate(x=subset(airtemp.long, select="airtemp"), by=list(airtemp.long$year_doy,airtemp.long$plot), FUN=min)
colnames(airtemp_min)<-c("year_doy","plot","airtemp_min")
airtemp_max<-aggregate(x=subset(airtemp.long, select="airtemp"), by=list(airtemp.long$year_doy,airtemp.long$plot), FUN=max)
colnames(airtemp_max)<-c("year_doy","plot","airtemp_max")
airtemp<-as.data.frame(cbind(airtemp_min$year_doy,airtemp_min$plot,airtemp_min$airtemp_min,airtemp_max$airtemp_max))
colnames(airtemp)<-c("year_doy","plot","airtemp_min","airtemp_max")
allclim<-merge(airtemp,soiltemp,by=c("year_doy","plot"), all=TRUE)
allclim2<-merge(allclim,soilmois,by=c("year_doy","plot"), all=TRUE)
allclim2$year<-substr(allclim2$year_doy,1,4)
allclim2$doy<-substr(allclim2$year_doy,5,7)
allclim2$site<-"clarkduke"
allclim2$temptreat<-NA
allclim2[allclim2$plot=="G01"|allclim2$plot=="G04"|allclim2$plot=="G07"|allclim2$plot=="S03"|allclim2$plot=="S04"|allclim2$plot=="S08",]$temptreat<-"sham"#disturbance control
allclim2[allclim2$plot=="G02"|allclim2$plot=="G06"|allclim2$plot=="G08"|allclim2$plot=="S01"|allclim2$plot=="S06"|allclim2$plot=="S07",]$temptreat<-2
allclim2[allclim2$plot=="G03"|allclim2$plot=="G05"|allclim2$plot=="G09"|allclim2$plot=="S02"|allclim2$plot=="S05"|allclim2$plot=="S09",]$temptreat<-1
allclim2[allclim2$plot=="G10"|allclim2$plot=="G11"|allclim2$plot=="G12"|allclim2$plot=="S10"|allclim2$plot=="S11"|allclim2$plot=="S12",]$temptreat<-0
allclim2$preciptreat<-NA
allclim2$preciptreat<-NA
allclim2$soiltemp2_min<-NA
allclim2$soiltemp2_max<-NA
allclim2$soiltemp1_mean<-(as.numeric(allclim2$soiltemp1_min)+as.numeric(allclim2$soiltemp1_max))/2
clarkdukeclim<-subset(allclim2, select=c("site","temptreat","preciptreat","plot","year","doy","airtemp_min","airtemp_max","soiltemp1_min","soiltemp2_min","soiltemp1_max","soiltemp2_max","soiltemp1_mean","soilmois"))
row.names(clarkdukeclim) <- NULL
return(clarkdukeclim)
}
##Dukes et al. data from BACE ##
## Data type: hourly soil temp, from 2 and 10 cm; soil mois=VWC, just using 2010 data sine that is when we have phenology
## Notes: data shared by Jeff Dukes (jsdukes@purdue.edu)
clean.clim$bace <- function(filename="2010SoilTempDaily.csv", path="./Experiments/bace") {
file <- file.path(path, filename)
soiltemp<- read.csv(file, header=TRUE,na.strings = ".")
colnames(soiltemp) [3:5]<-c("doy","plot","temptreat")
colnames(soiltemp) [9:12]<-c("soiltemp1_min","soiltemp2_min","soiltemp1_max","soiltemp2_max")
soiltemp$preciptreat<-NA
soiltemp[soiltemp$precip.treatment==1,]$preciptreat<-0#ambient precip
soiltemp[soiltemp$precip.treatment==0,]$preciptreat<--1#50% precip
soiltemp[soiltemp$precip.treatment==2,]$preciptreat<-1#150% ambient precip
file2 <- file.path(path, "bace_soilmoisture2010.csv")
soilmois<-read.csv(file2, header=T,na.strings = ".")
colnames(soilmois)[3]<-"doy"
allclim<-merge(soiltemp,soilmois,by=c("year","doy","plot"),all=TRUE)
colnames(allclim)[17]<-"soilmois"
allclim[which(allclim$soilmois==209),]$soilmois<-NA#remove weird values for soil moisture, which should be between 0 and 1 (209, 1.87)
allclim[which(allclim$soilmois==1.87),]$soilmois<-NA
allclim$airtemp_min<-NA
allclim$airtemp_max<-NA
allclim$site<-"bace"
allclim$soiltemp1_mean<-(as.numeric(allclim$soiltemp1_min)+as.numeric(allclim$soiltemp1_max))/2
baceclim<-subset(allclim, select=c("site","temptreat","preciptreat","plot","year","doy","airtemp_min","airtemp_max","soiltemp1_min","soiltemp2_min","soiltemp1_max","soiltemp2_max","soiltemp1_mean","soilmois"))
row.names(baceclim) <- NULL
return(baceclim)
}
##Chuine et al. data from ??? ##
## Data type: hourly soil temp, from 2 and 10 cm; soil mois=VWC, just using 2010 data sine that is when we have phenology
## Notes: data shared by isabelle chuine (isabelle.chuine@cefe.cnrs.fr)
clean.clim$chuine <- function(path="./Experiments/chuine") {
soilfiles<-c("TDR2002.csv","TDR2003.csv","TDR2004.csv","TDR2005.csv")
soiltemp<- read.csv(file, header=TRUE,na.strings = ".")
for (i in 1:length(maxtempfiles)){
file <- file.path(path, paste(maxtempfiles[i]))
maxtemp1 <- read.csv(file, skip=1,header=TRUE)
##Produce cleaned, raw climate data
raw.data.dir <- "./Experiments/"
cleanclimdata.raw <- list()
cleanclimdata.raw$marchin <- clean.clim$marchin(path="./Experiments/marchin")
cleanclimdata.raw$farnsworth <- clean.clim$farnsworth(path="./Experiments/farnsworth/")
cleanclimdata.raw$clarkharvard <- clean.clim$clarkharvard(path="./Experiments/clark/")
cleanclimdata.raw$clarkduke <- clean.clim$clarkduke(path="./Experiments/clark/")
cleanclimdata.raw$bace <- clean.clim$bace(path="./Experiments/bace")
cleanclimdata.raw$chuine <- clean.clim$chuine(path="./Experiments/chuine")
#cleanclimdata.raw$jasper <- clean.clim$jasper(path="./Experiments/jasper")still waiting for data
#cleanclimdata.raw$oklahoma <- clean.clim$oklahoma(path="./Experiments/sherry")still waiting for data
expphenclim <- do.call("rbind", cleanclimdata.raw)
row.names(expphenclim) <- NULL
tbase<-10
expphenclim$gdd_soil<-expphenclim$soiltemp1_mean-tbase
expphenclim$gdd_air<-((as.numeric(expphenclim$airtemp_min)+as.numeric(expphenclim$airtemp_max))/2)-tbase
setwd("~/GitHub/radcliffe/radmeeting")
obsclim<-read.csv("obsclim.csv", header=T)
expclim<-read.csv("expclim.csv", header=T)
exppheno<-read.csv("exppheno.csv", header=T)
obspheno<-read.csv("obspheno.csv", header=T)
setwd("~/GitHub/radcliffe/radmeeting")
obsclim<-read.csv("obsclim.csv", header=T)
expclim<-read.csv("expclim.csv", header=T)
exppheno<-read.csv("exppheno.csv", header=T)
obspheno<-read.csv("obspheno.csv", header=T)
head(expclim)
obsmat<-aggregate(x=subset(obsclim, select=c("tmean")), by=list(obsclim$year,obsclim$site), FUN=mean, na.rm=T)
colnames(obsmat)[1:2]<-c("year","site")
head(obsmat)
head(expclim)
head(obsmat)
head(obsclim)
as.numeric(tempallsites$doy)
tempallsites$doy<-as.numeric(tempallsites$doy)
tempallsites<-tempallsites[order(tempallsites$year, tempallsites$doy),]
head(tempallsites)
tempallsites<-tempallsites[order(tempallsites$site,tempallsites$year, tempallsites$doy),]
head(tempallsites)
row.names(tempallsites) <- NULL
write.csv(tempallsites,"radmeeting/obsclim.csv", row.names=FALSE)
setwd("~/GitHub/radcliffe")
write.csv(tempallsites,"radmeeting/obsclim.csv", row.names=FALSE)
obsclim<-read.csv("obsclim.csv", header=T)
setwd("~/GitHub/radcliffe/radmeeting")
obsclim<-read.csv("obsclim.csv", header=T)
cumsum(1:10)
length(cumsum(1:10))
head(tempallsites)
tempallsites$cumgdd <- ave(tempallsites$site,tempallsites$year, FUN=cumsum)
warnings()
head(tempallsites)
tempallsites$cumgdd <- ave((tempallsites$gdd_10,list(tempallsites$site,tempallsites$year), FUN=cumsum)
tempallsites$cumgdd <- ave(tempallsites$gdd_10,list(tempallsites$site,tempallsites$year), FUN=cumsum)
head(tempallsites)
tempallsites[365:385,]
tempallsites$gdd_10[tempallsites$gdd_10 < 10] <- 0
head(tempallsite)
head(tempallsites)
tempallsites$cumgdd <- ave(tempallsites$gdd_10,list(tempallsites$site,tempallsites$year), FUN=cumsum)
head(tempallsites)
tempallsites[365:385,]
row.names(tempallsites) <- NULL
write.csv(tempallsites,"radmeeting/obsclim.csv", row.names=FALSE)
setwd("~/GitHub/radcliffe")
write.csv(tempallsites,"radmeeting/obsclim.csv", row.names=FALSE)
obsclim<-read.csv("obsclim.csv", header=T)
setwd("~/GitHub/radcliffe/radmeeting")
obsclim<-read.csv("obsclim.csv", header=T)
head(expphenclim)
setwd("~/GitHub/radcliffe")
raw.data.dir <- "./Experiments/"
cleanclimdata.raw <- list()
cleanclimdata.raw$marchin <- clean.clim$marchin(path="./Experiments/marchin")
cleanclimdata.raw$farnsworth <- clean.clim$farnsworth(path="./Experiments/farnsworth/")
cleanclimdata.raw$clarkharvard <- clean.clim$clarkharvard(path="./Experiments/clark/")
cleanclimdata.raw$clarkharvard <- clean.clim$clarkharvard(path="./Experiments/clark/")
cleanclimdata.raw$clarkduke <- clean.clim$clarkduke(path="./Experiments/clark/")
cleanclimdata.raw$bace <- clean.clim$bace(path="./Experiments/bace")
expphenclim <- do.call("rbind", cleanclimdata.raw)
row.names(expphenclim) <- NULL
tbase<-10
expphenclim$gdd_soil<-expphenclim$soiltemp1_mean-tbase
expphenclim$gdd_air<-((as.numeric(expphenclim$airtemp_min)+as.numeric(expphenclim$airtemp_max))/2)-tbase
expphenclim<-expphenclim[order(expphenclim$site,expphenclim$year, expphenclim$doy),]
head(expphenclim)
expphenclim$gdd_soil<-expphenclim$soiltemp1_mean-tbase
expphenclim$gdd_air<-((as.numeric(expphenclim$airtemp_min)+as.numeric(expphenclim$airtemp_max))/2)-tbase
expphenclim<-expphenclim[order(expphenclim$site,expphenclim$year, expphenclim$doy),]
head(expphenclim)
expphenclim$doy<-as.numeric(expphenclim$doy)
head(expphenclim)
unique(expphenclim$doy)
exphenclim[which(is.na(exphenclim$doy)),]
expphenclim[which(is.na(exphenclim$doy)),]
expphenclim[which(is.na(expphenclim$doy)),]
expphenclim <- do.call("rbind", cleanclimdata.raw)
row.names(expphenclim) <- NULL
unique(expphenclim$doy)
expphenclim[which(is.na(expphenclim$doy)),]
expphenclim[which(expphenclim$doy=="NA"),]
head(expphenclim)
expphenclim$doy<-as.numeric(expphenclim$doy)
head(expphenclim)
dim(expphendb)
expphendb<-expphendb[!is.na(expphendb$doy),]
dim(expphendb)
expphendb<-expphendb[-is.na(expphendb$doy),]
dim(expphendb)
expphenclim <- do.call("rbind", cleanclimdata.raw)
row.names(expphenclim) <- NULL
dim(expphendb)
expphenclim <- do.call("rbind", cleanclimdata.raw)
row.names(expphenclim) <- NULL
dim(expphendb)
expphenclim <- do.call("rbind", cleanclimdata.raw)
row.names(expphenclim) <- NULL
dim(expphendb)
head(cleanclimdata.raw)
expphenclim <- do.call("rbind", cleanclimdata.raw)
expphenclim1 <- do.call("rbind", cleanclimdata.raw)
row.names(expphenclim1) <- NULL
dim(expphendb1)
dim(expphenclimdb)
dim(expphenclim)
expphenclim<-[-which(expphenclim$doy=="NA"),]
expphenclim<-expphenclim[-which(expphenclim$doy=="NA"),]
dim(expphenclim)
expphenclim$doy<-as.numeric(expphenclim$doy)
head(expphenclim)
tbase<-10
expphenclim$gdd_soil<-expphenclim$soiltemp1_mean-tbase
expphenclim$gdd_air<-((as.numeric(expphenclim$airtemp_min)+as.numeric(expphenclim$airtemp_max))/2)-tbase
expphenclim<-expphenclim[order(expphenclim$site,expphenclim$year, expphenclim$doy),]
expphenclim$gdd_soil[expphenclim$gdd_soil < 10] <- 0
expphenclim$gdd_air[expphenclim$gdd_air < 10] <- 0
expphenclim$cumgdd_air <- ave(expphenclim$gdd_air,list(expphenclim$site,expphenclim$year), FUN=cumsum)
expphenclim$cumgdd_soil <- ave(expphenclim$gdd_soil,list(expphenclim$site,expphenclim$year), FUN=cumsum)
head(expphenclim)
expphenclim<-expphenclim[order(expphenclim$site,expphenclim$plot,expphenclim$year, expphenclim$doy),]
expphenclim$gdd_soil[expphenclim$gdd_soil < 10] <- 0
expphenclim$gdd_air[expphenclim$gdd_air < 10] <- 0
head(expphenclim)
expphenclim$cumgdd_air <- ave(expphenclim$gdd_air,list(expphenclim$site,expphenclim$plot,expphenclim$year), FUN=cumsum)
expphenclim$cumgdd_soil <- ave(expphenclim$gdd_soil,list(expphenclim$site,expphenclim$plot,expphenclim$year), FUN=cumsum)
head(expphenclim)
expphenclim[365:385,]
expphenclim[180:205,]
expphenclim[205:215,]
expphenclim$cumgdd_air <- ave(expphenclim$gdd_air,list(expphenclim$site,expphenclim$plot,expphenclim$year), FUN=cumsum, na.rm=T)
expphenclim$cumgdd_air <- ave(expphenclim$gdd_air,list(expphenclim$site,expphenclim$plot,expphenclim$year), FUN=cumsum)
expphenclim$cumgdd_soil <- ave(expphenclim$gdd_soil,list(expphenclim$site,expphenclim$plot,expphenclim$year), FUN=cumsum)
`expphenclim[205:215,]``
expphenclim[205:215,]
''
''
